<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Allergenicity Predictor</title>
  <link href="/static/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container my-5">
    <h1>Allergenicity Predictor</h1>
    <form method="post">
      <div class="form-group">
        <label>Protein Sequence</label>
        <textarea name="sequence" class="form-control" rows="4">{{ request.form.sequence or '' }}</textarea>
      </div>
      <div class="form-group">
        <label>Decision Threshold: <span id="thresh-val">0.5</span></label>
        <input type="range" name="threshold" min="0" max="1" step="0.01" value="0.5" id="threshold-slider" class="form-control-range">
      </div>
      <button class="btn btn-primary">Predict</button>
    </form>

    {% if result %}
    <div class="mt-4 alert alert-info">
      <h4>Result</h4>
      <p><strong>Prediction:</strong> {{ result.prediction }}</p>
      <p><strong>Probability:</strong> {{ '%.4f'|format(result.probability) }}</p>
    </div>

    <div class="mt-4">
      <h5>SHAP Values</h5>
      <div id="shap-chart"></div>
    </div>
    {% endif %}
  </div>
  <script src="/static/js/d3.min.js"></script>
  <script src="/static/js/shap_plot.js"></script>
  <script>
    const slider = document.getElementById('threshold-slider');
    const display = document.getElementById('thresh-val');
    slider.oninput = () => display.textContent = slider.value;
    {% if explanation %}
      shap_plot('shap-chart', {{ explanation|tojson }});
    {% endif %}
  </script>
</body>
</html>